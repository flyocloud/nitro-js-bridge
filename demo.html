<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyo Nitro JS Bridge Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .editable-block {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <h1>Flyo Nitro JS Bridge Demo</h1>
    
    <div class="status" id="embeddedStatus">
        Checking embedded status...
    </div>

    <div class="demo-section">
        <h2>Basic Open Function</h2>
        <p>Click the button below to trigger the open function:</p>
        <button onclick="testOpen()">Open Block (basic)</button>
        <div id="openResult"></div>
    </div>

    <div class="demo-section">
        <h2>Enhanced Highlight and Click</h2>
        <p>The blocks below have enhanced hover effects when in embedded preview mode:</p>
        
        <div class="editable-block" data-flyo-uid="demo-block-1">
            <h3>Demo Block 1</h3>
            <p>This is an editable content block. When embedded in Flyo's preview, hover over this block to see the visual feedback.</p>
        </div>

        <div class="editable-block" data-flyo-uid="demo-block-2">
            <h3>Demo Block 2</h3>
            <p>Another editable block with different content. Each block can have its own unique identifier.</p>
        </div>

        <div class="editable-block" data-flyo-uid="demo-block-3">
            <h3>Demo Block 3</h3>
            <p>Try hovering over this block too. The visual feedback helps users understand what's clickable.</p>
        </div>
    </div>

    <div class="demo-section">
        <h2>Manual Testing</h2>
        <p>You can manually test individual functions:</p>
        <button onclick="testIsEmbedded()">Check if Embedded</button>
        <button onclick="testHighlightAndClick()">Setup Highlight & Click</button>
        <div id="testResults"></div>
    </div>

    <script type="module">
        // Import functions from the built library
        import { open, highlightAndClick, isEmbedded } from './dist/nitro-js-bridge.js';

        // Make functions available globally for button onclick handlers
        window.testOpen = () => {
            console.log('Testing open function...');
            open('demo-block-test');
            document.getElementById('openResult').innerHTML = '<p>✓ Open function called (check console for details)</p>';
        };

        window.testIsEmbedded = () => {
            const embedded = isEmbedded();
            const result = embedded ? 'Yes, embedded in iframe' : 'No, not embedded';
            document.getElementById('testResults').innerHTML = `<p>Embedded status: ${result}</p>`;
        };

        window.testHighlightAndClick = () => {
            const elements = document.querySelectorAll('[data-flyo-uid]');
            elements.forEach(element => {
                const blockUid = element.dataset.flyoUid;
                const cleanup = highlightAndClick(blockUid, element);
                console.log(`Setup highlight and click for ${blockUid}`);
            });
            document.getElementById('testResults').innerHTML = '<p>✓ Highlight and click setup complete</p>';
        };

        // Initialize the demo
        document.addEventListener('DOMContentLoaded', () => {
            // Check embedded status
            const embedded = isEmbedded();
            const statusElement = document.getElementById('embeddedStatus');
            if (embedded) {
                statusElement.innerHTML = '✓ <strong>Embedded mode detected</strong> - Visual feedback will be active';
                statusElement.style.background = '#d4edda';
                statusElement.style.color = '#155724';
            } else {
                statusElement.innerHTML = 'ℹ <strong>Not embedded</strong> - To see visual feedback, view this page in an iframe';
                statusElement.style.background = '#d1ecf1';
                statusElement.style.color = '#0c5460';
            }

            // Auto-setup highlight and click for all blocks
            const elements = document.querySelectorAll('[data-flyo-uid]');
            elements.forEach(element => {
                const blockUid = element.dataset.flyoUid;
                highlightAndClick(blockUid, element);
            });

            console.log('Demo initialized with', elements.length, 'editable blocks');
        });
    </script>
</body>
</html>